## JWT를 localStorage에 저장한 이유

JWT(JSON Web Tokens)를 사용할 때 해당 토큰을 클라이언트 측에서 어디에 저장할지 결정하는 것은 중요한 보안 결정이다. 일반적으로 토큰은 쿠키 또는 localStorage, sessionStorage 중 하나에 저장될 수 있다.

localStorage에 JWT를 저장하기로 결정한 경우, 그에 대한 일반적인 이유는 다음과 같을 수 있다:

### 1. **간단하고 직관적인 관리:**

localStorage를 사용하여 토큰을 관리하는 것은 코드 작성 측면에서 간단하다. 토큰을 설정, 검색, 제거하는 API가 명확하고 직관적이므로 개발자가 쉽게 사용할 수 있다. 쿠키를 사용할 때보다 복잡한 설정이 적고, 서버 측에서 쿠키를 설정, 전송, 해석하는 추가 작업이 필요하지 않다.

### 2. **도메인 간 요청에 대한 제어:**

쿠키는 브라우저에 의해 자동으로 설정되며 모든 요청에 포함된다. 이는 때로는 원치 않는 도메인 간 요청에 대한 문제를 초래할 수 있다. 반면, localStorage에 토큰을 저장하면 어떤 요청에 토큰을 포함할지 개발자가 직접 제어할 수 있다.

### 3. **크로스 사이트 요청 위조(CSRF) 공격에 대한 내성:**

쿠키를 사용하는 경우, 애플리케이션은 CSRF 공격에 취약해질 수 있다. 반면, localStorage를 사용하면 이러한 공격으로부터 자연스럽게 보호받을 수 있다. 그러나 이는 크로스 사이트 스크립팅(XSS) 공격에 더 취약해질 수 있다는 점을 감안해야 한다.

비록 이러한 이유로 인해 localStorage를 사용하는 것이 바람직할 수 있지만, 보안 관점에서 이 방법이 항상 최선은 아니다. 특히 XSS 공격에 더 취약해지기 때문에 애플리케이션의 XSS를 방지하는 다른 방어책이 강화되어 있어야 한다. 결국, JWT 저장 위치를 결정하는 것은 해당 애플리케이션의 전반적인 보안 전략의 일부여야 한다.

## XSS에 대하여

XSS(Cross-Site Scripting)는 공격자가 신뢰받는 웹사이트에 악성 스크립트를 삽입할 수 있는 코드 인젝션 공격 유형이다. 이 악성 스크립트는 다른 사용자의 브라우저에서 실행되며, 공격자에게 해당 사용자의 세션 토큰이나 다른 민감한 정보를 훔칠 수 있는 기회를 제공할 수 있다.

### XSS 방어책

1. 입력 검증: 사용자로부터의 모든 입력을 검증하고, 예상치 않은 입력(특수 문자 등)이 시스템에 저장되거나 응답에 포함되지 않도록 한다.

2. 출력 인코딩: 사용자 입력이 웹 페이지에 반영될 때 항상 적절한 인코딩을 사용한다. 이렇게 하면 스크립트가 브라우저에서 실행되는 것이 아니라 단순 텍스트로 처리되어, 악의적인 스크립트 실행을 방지할 수 있다.

3. 컨텐츠 보안 정책 (CSP): CSP는 서버가 브라우저에게 어떤 외부 자원이 해당 웹 페이지에서 실행되거나 로드될 수 있는지를 알려주는 헤더를 설정함으로써 작동한다. 이 정책을 통해, 공격자가 악성 스크립트를 주입하더라도 실행되지 않도록 할 수 있다.

4. 쿠키 플래그: HttpOnly 및 Secure 플래그를 사용하여 쿠키를 설정한다. HttpOnly는 자바스크립트를 통한 쿠키 접근을 방지하고, Secure는 안전한 연결을 통해서만 쿠키를 전송하도록 제한한다.

### local Storage가 쿠키보다 XSS 공격에 취약한 이유

`localStorage`와 쿠키 사이의 보안 문제는 다루기가 다소 복잡하다. 이 둘 다 웹 스토리지 옵션이지만, 각각의 취약점을 가지고 있다. 특히, XSS 공격과 관련하여 `localStorage`가 쿠키보다 더 취약한 이유를 몇 가지 살펴보자.

1. **JavaScript 접근성:** 가장 큰 차이점은 JavaScript에서의 접근 가능성이다. `localStorage`는 JavaScript를 통해 완전히 접근할 수 있으며, 이는 XSS 공격의 일환으로 악성 스크립트가 주입되면 공격자가 사용자의 `localStorage`에 직접 접근할 수 있음을 의미한다. 반면, 쿠키는 `HttpOnly` 플래그가 설정되어 있으면 JavaScript를 통한 접근이 불가능하므로, 이런 방식의 공격으로부터 안전하다.

2. **자동 전송:** 쿠키는 도메인과 관련된 모든 요청과 함께 자동으로 전송되지만, `localStorage`는 그렇지 않다. 이는 공격자가 사용자의 컨텍스트에서 웹사이트와 상호작용하려고 시도할 때 특히 중요한데, 쿠키는 악의적인 요청을 인증할 수 있지만, `localStorage` 데이터는 자동으로는 전송되지 않는다. 그러나 XSS 공격이 성공하면, 공격자는 `localStorage`에서 데이터를 추출하고 자신의 서버로 직접 전송할 수 있다.

3. **보안 속성의 부재:** 쿠키에는 여러 보안 속성(예: `Secure`, `HttpOnly`, `SameSite`)이 있어, 적절히 설정하면 스크립트와 네트워크 기반 공격으로부터 보호할 수 있다. 반면, `localStorage`는 이러한 추가 보안 계층을 제공하지 않는다.

결국, `localStorage`의 이러한 취약성은 XSS 공격자가 사용자 데이터를 더 쉽게 훔칠 수 있음을 의미한다. 애플리케이션이 XSS 취약점을 가지고 있을 경우, `localStorage`에 저장된 데이터는 공격자가 쉽게 접근하고 조작할 수 있으므로, 특히 인증 토큰과 같은 민감한 정보를 저장할 때는 더욱 신중해야 한다.
